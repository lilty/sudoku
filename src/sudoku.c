#include "sudoku.h"
#include <ctype.h>

static int T[3] = {0x1FF, 0x3FE00, 0x7FC0000};

int tbl_mult3[9] = {
  0x0, 0x3, 0x6, 0x9, 0xC, 0xF, 0x12, 0x15,
  0x18,
};

int tbl_number_one[512] = {
  0x0, 0x1, 0x1, 0x2, 0x1, 0x2, 0x2, 0x3,
  0x1, 0x2, 0x2, 0x3, 0x2, 0x3, 0x3, 0x4,
  0x1, 0x2, 0x2, 0x3, 0x2, 0x3, 0x3, 0x4,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x1, 0x2, 0x2, 0x3, 0x2, 0x3, 0x3, 0x4,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x1, 0x2, 0x2, 0x3, 0x2, 0x3, 0x3, 0x4,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x1, 0x2, 0x2, 0x3, 0x2, 0x3, 0x3, 0x4,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x5, 0x6, 0x6, 0x7, 0x6, 0x7, 0x7, 0x8,
  0x1, 0x2, 0x2, 0x3, 0x2, 0x3, 0x3, 0x4,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x5, 0x6, 0x6, 0x7, 0x6, 0x7, 0x7, 0x8,
  0x2, 0x3, 0x3, 0x4, 0x3, 0x4, 0x4, 0x5,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x5, 0x6, 0x6, 0x7, 0x6, 0x7, 0x7, 0x8,
  0x3, 0x4, 0x4, 0x5, 0x4, 0x5, 0x5, 0x6,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x5, 0x6, 0x6, 0x7, 0x6, 0x7, 0x7, 0x8,
  0x4, 0x5, 0x5, 0x6, 0x5, 0x6, 0x6, 0x7,
  0x5, 0x6, 0x6, 0x7, 0x6, 0x7, 0x7, 0x8,
  0x5, 0x6, 0x6, 0x7, 0x6, 0x7, 0x7, 0x8,
  0x6, 0x7, 0x7, 0x8, 0x7, 0x8, 0x8, 0x9,
};

int tbl_another1[27] = {
  0x1, 0x0, 0x0, 0x4, 0x3, 0x3, 0x7, 0x6,
  0x6, 0xA, 0x9, 0x9, 0xD, 0xC, 0xC, 0x10,
  0xF, 0xF, 0x13, 0x12, 0x12, 0x16, 0x15, 0x15,
  0x19, 0x18, 0x18,
};

int tbl_another2[27] = {
  0x2, 0x2, 0x1, 0x5, 0x5, 0x4, 0x8, 0x8,
  0x7, 0xB, 0xB, 0xA, 0xE, 0xE, 0xD, 0x11,
  0x11, 0x10, 0x14, 0x14, 0x13, 0x17, 0x17, 0x16,
  0x1A, 0x1A, 0x19,
};

int tbl_board_block[81] = {
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x1, 0x1, 0x1, 0x1, 0x1,
  0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1,
  0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1,
  0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x2, 0x2,
  0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x2,
};

int tbl_board_block_mask[81] = {
  0x1, 0x2, 0x4, 0x8, 0x10, 0x20, 0x40, 0x80,
  0x100, 0x200, 0x400, 0x800, 0x1000, 0x2000, 0x4000, 0x8000,
  0x10000, 0x20000, 0x40000, 0x80000, 0x100000, 0x200000, 0x400000, 0x800000,
  0x1000000, 0x2000000, 0x4000000, 0x1, 0x2, 0x4, 0x8, 0x10,
  0x20, 0x40, 0x80, 0x100, 0x200, 0x400, 0x800, 0x1000,
  0x2000, 0x4000, 0x8000, 0x10000, 0x20000, 0x40000, 0x80000, 0x100000,
  0x200000, 0x400000, 0x800000, 0x1000000, 0x2000000, 0x4000000, 0x1, 0x2,
  0x4, 0x8, 0x10, 0x20, 0x40, 0x80, 0x100, 0x200,
  0x400, 0x800, 0x1000, 0x2000, 0x4000, 0x8000, 0x10000, 0x20000,
  0x40000, 0x80000, 0x100000, 0x200000, 0x400000, 0x800000, 0x1000000, 0x2000000,
  0x4000000,
};

int tbl_self_mask[81] = {
  0x37E3F001, 0x37E3F002, 0x37E3F004, 0x371F8E08, 0x371F8E10, 0x371F8E20, 0x30FC7E40, 0x30FC7E80,
  0x30FC7F00, 0x2FE003F8, 0x2FE005F8, 0x2FE009F8, 0x2F1C11C7, 0x2F1C21C7, 0x2F1C41C7, 0x28FC803F,
  0x28FD003F, 0x28FE003F, 0x1807F1F8, 0x180BF1F8, 0x1813F1F8, 0x18238FC7, 0x18438FC7, 0x18838FC7,
  0x19007E3F, 0x1A007E3F, 0x1C007E3F, 0x37E3F001, 0x37E3F002, 0x37E3F004, 0x371F8E08, 0x371F8E10,
  0x371F8E20, 0x30FC7E40, 0x30FC7E80, 0x30FC7F00, 0x2FE003F8, 0x2FE005F8, 0x2FE009F8, 0x2F1C11C7,
  0x2F1C21C7, 0x2F1C41C7, 0x28FC803F, 0x28FD003F, 0x28FE003F, 0x1807F1F8, 0x180BF1F8, 0x1813F1F8,
  0x18238FC7, 0x18438FC7, 0x18838FC7, 0x19007E3F, 0x1A007E3F, 0x1C007E3F, 0x37E3F001, 0x37E3F002,
  0x37E3F004, 0x371F8E08, 0x371F8E10, 0x371F8E20, 0x30FC7E40, 0x30FC7E80, 0x30FC7F00, 0x2FE003F8,
  0x2FE005F8, 0x2FE009F8, 0x2F1C11C7, 0x2F1C21C7, 0x2F1C41C7, 0x28FC803F, 0x28FD003F, 0x28FE003F,
  0x1807F1F8, 0x180BF1F8, 0x1813F1F8, 0x18238FC7, 0x18438FC7, 0x18838FC7, 0x19007E3F, 0x1A007E3F,
  0x1C007E3F,
};

int tbl_other_mask[81] = {
  0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F,
  0x3BFDFEFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF,
  0x3DFEFF7F, 0x3BFDFEFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF,
  0x3EFF7FBF, 0x3DFEFF7F, 0x3BFDFEFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF,
  0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F, 0x3BFDFEFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7,
  0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F, 0x3BFDFEFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB,
  0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F, 0x3BFDFEFF, 0x3FFBFDFE, 0x3FF7FBFD,
  0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F, 0x3BFDFEFF, 0x3FFBFDFE,
  0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F, 0x3BFDFEFF,
  0x3FFBFDFE, 0x3FF7FBFD, 0x3FEFF7FB, 0x3FDFEFF7, 0x3FBFDFEF, 0x3F7FBFDF, 0x3EFF7FBF, 0x3DFEFF7F,
  0x3BFDFEFF,
};

int tbl_mask_single[512] = {
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FDFEFF7, 0x3FDBEDF6, 0x3FD7EBF5, 0x3FDFEFF7, 0x3FCFE7F3, 0x3FDFEFF7, 0x3FDFEFF7, 0x3FDFEFF7,
  0x3FBFDFEF, 0x3FBBDDEE, 0x3FB7DBED, 0x3FBFDFEF, 0x3FAFD7EB, 0x3FBFDFEF, 0x3FBFDFEF, 0x3FBFDFEF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3F7FBFDF, 0x3F7BBDDE, 0x3F77BBDD, 0x3F7FBFDF, 0x3F6FB7DB, 0x3F7FBFDF, 0x3F7FBFDF, 0x3F7FBFDF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3EFF7FBF, 0x3EFB7DBE, 0x3EF77BBD, 0x3EFF7FBF, 0x3EEF77BB, 0x3EFF7FBF, 0x3EFF7FBF, 0x3EFF7FBF,
  0x3EDF6FB7, 0x3EDB6DB6, 0x3ED76BB5, 0x3EDF6FB7, 0x3ECF67B3, 0x3EDF6FB7, 0x3EDF6FB7, 0x3EDF6FB7,
  0x3EBF5FAF, 0x3EBB5DAE, 0x3EB75BAD, 0x3EBF5FAF, 0x3EAF57AB, 0x3EBF5FAF, 0x3EBF5FAF, 0x3EBF5FAF,
  0x3EFF7FBF, 0x3EFB7DBE, 0x3EF77BBD, 0x3EFF7FBF, 0x3EEF77BB, 0x3EFF7FBF, 0x3EFF7FBF, 0x3EFF7FBF,
  0x3E7F3F9F, 0x3E7B3D9E, 0x3E773B9D, 0x3E7F3F9F, 0x3E6F379B, 0x3E7F3F9F, 0x3E7F3F9F, 0x3E7F3F9F,
  0x3EFF7FBF, 0x3EFB7DBE, 0x3EF77BBD, 0x3EFF7FBF, 0x3EEF77BB, 0x3EFF7FBF, 0x3EFF7FBF, 0x3EFF7FBF,
  0x3EFF7FBF, 0x3EFB7DBE, 0x3EF77BBD, 0x3EFF7FBF, 0x3EEF77BB, 0x3EFF7FBF, 0x3EFF7FBF, 0x3EFF7FBF,
  0x3EFF7FBF, 0x3EFB7DBE, 0x3EF77BBD, 0x3EFF7FBF, 0x3EEF77BB, 0x3EFF7FBF, 0x3EFF7FBF, 0x3EFF7FBF,
  0x3DFEFF7F, 0x3DFAFD7E, 0x3DF6FB7D, 0x3DFEFF7F, 0x3DEEF77B, 0x3DFEFF7F, 0x3DFEFF7F, 0x3DFEFF7F,
  0x3DDEEF77, 0x3DDAED76, 0x3DD6EB75, 0x3DDEEF77, 0x3DCEE773, 0x3DDEEF77, 0x3DDEEF77, 0x3DDEEF77,
  0x3DBEDF6F, 0x3DBADD6E, 0x3DB6DB6D, 0x3DBEDF6F, 0x3DAED76B, 0x3DBEDF6F, 0x3DBEDF6F, 0x3DBEDF6F,
  0x3DFEFF7F, 0x3DFAFD7E, 0x3DF6FB7D, 0x3DFEFF7F, 0x3DEEF77B, 0x3DFEFF7F, 0x3DFEFF7F, 0x3DFEFF7F,
  0x3D7EBF5F, 0x3D7ABD5E, 0x3D76BB5D, 0x3D7EBF5F, 0x3D6EB75B, 0x3D7EBF5F, 0x3D7EBF5F, 0x3D7EBF5F,
  0x3DFEFF7F, 0x3DFAFD7E, 0x3DF6FB7D, 0x3DFEFF7F, 0x3DEEF77B, 0x3DFEFF7F, 0x3DFEFF7F, 0x3DFEFF7F,
  0x3DFEFF7F, 0x3DFAFD7E, 0x3DF6FB7D, 0x3DFEFF7F, 0x3DEEF77B, 0x3DFEFF7F, 0x3DFEFF7F, 0x3DFEFF7F,
  0x3DFEFF7F, 0x3DFAFD7E, 0x3DF6FB7D, 0x3DFEFF7F, 0x3DEEF77B, 0x3DFEFF7F, 0x3DFEFF7F, 0x3DFEFF7F,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FDFEFF7, 0x3FDBEDF6, 0x3FD7EBF5, 0x3FDFEFF7, 0x3FCFE7F3, 0x3FDFEFF7, 0x3FDFEFF7, 0x3FDFEFF7,
  0x3FBFDFEF, 0x3FBBDDEE, 0x3FB7DBED, 0x3FBFDFEF, 0x3FAFD7EB, 0x3FBFDFEF, 0x3FBFDFEF, 0x3FBFDFEF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3F7FBFDF, 0x3F7BBDDE, 0x3F77BBDD, 0x3F7FBFDF, 0x3F6FB7DB, 0x3F7FBFDF, 0x3F7FBFDF, 0x3F7FBFDF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3BFDFEFF, 0x3BF9FCFE, 0x3BF5FAFD, 0x3BFDFEFF, 0x3BEDF6FB, 0x3BFDFEFF, 0x3BFDFEFF, 0x3BFDFEFF,
  0x3BDDEEF7, 0x3BD9ECF6, 0x3BD5EAF5, 0x3BDDEEF7, 0x3BCDE6F3, 0x3BDDEEF7, 0x3BDDEEF7, 0x3BDDEEF7,
  0x3BBDDEEF, 0x3BB9DCEE, 0x3BB5DAED, 0x3BBDDEEF, 0x3BADD6EB, 0x3BBDDEEF, 0x3BBDDEEF, 0x3BBDDEEF,
  0x3BFDFEFF, 0x3BF9FCFE, 0x3BF5FAFD, 0x3BFDFEFF, 0x3BEDF6FB, 0x3BFDFEFF, 0x3BFDFEFF, 0x3BFDFEFF,
  0x3B7DBEDF, 0x3B79BCDE, 0x3B75BADD, 0x3B7DBEDF, 0x3B6DB6DB, 0x3B7DBEDF, 0x3B7DBEDF, 0x3B7DBEDF,
  0x3BFDFEFF, 0x3BF9FCFE, 0x3BF5FAFD, 0x3BFDFEFF, 0x3BEDF6FB, 0x3BFDFEFF, 0x3BFDFEFF, 0x3BFDFEFF,
  0x3BFDFEFF, 0x3BF9FCFE, 0x3BF5FAFD, 0x3BFDFEFF, 0x3BEDF6FB, 0x3BFDFEFF, 0x3BFDFEFF, 0x3BFDFEFF,
  0x3BFDFEFF, 0x3BF9FCFE, 0x3BF5FAFD, 0x3BFDFEFF, 0x3BEDF6FB, 0x3BFDFEFF, 0x3BFDFEFF, 0x3BFDFEFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FDFEFF7, 0x3FDBEDF6, 0x3FD7EBF5, 0x3FDFEFF7, 0x3FCFE7F3, 0x3FDFEFF7, 0x3FDFEFF7, 0x3FDFEFF7,
  0x3FBFDFEF, 0x3FBBDDEE, 0x3FB7DBED, 0x3FBFDFEF, 0x3FAFD7EB, 0x3FBFDFEF, 0x3FBFDFEF, 0x3FBFDFEF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3F7FBFDF, 0x3F7BBDDE, 0x3F77BBDD, 0x3F7FBFDF, 0x3F6FB7DB, 0x3F7FBFDF, 0x3F7FBFDF, 0x3F7FBFDF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FDFEFF7, 0x3FDBEDF6, 0x3FD7EBF5, 0x3FDFEFF7, 0x3FCFE7F3, 0x3FDFEFF7, 0x3FDFEFF7, 0x3FDFEFF7,
  0x3FBFDFEF, 0x3FBBDDEE, 0x3FB7DBED, 0x3FBFDFEF, 0x3FAFD7EB, 0x3FBFDFEF, 0x3FBFDFEF, 0x3FBFDFEF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3F7FBFDF, 0x3F7BBDDE, 0x3F77BBDD, 0x3F7FBFDF, 0x3F6FB7DB, 0x3F7FBFDF, 0x3F7FBFDF, 0x3F7FBFDF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FDFEFF7, 0x3FDBEDF6, 0x3FD7EBF5, 0x3FDFEFF7, 0x3FCFE7F3, 0x3FDFEFF7, 0x3FDFEFF7, 0x3FDFEFF7,
  0x3FBFDFEF, 0x3FBBDDEE, 0x3FB7DBED, 0x3FBFDFEF, 0x3FAFD7EB, 0x3FBFDFEF, 0x3FBFDFEF, 0x3FBFDFEF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3F7FBFDF, 0x3F7BBDDE, 0x3F77BBDD, 0x3F7FBFDF, 0x3F6FB7DB, 0x3F7FBFDF, 0x3F7FBFDF, 0x3F7FBFDF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFBFDFE, 0x3FF7FBFD, 0x3FFFFFFF, 0x3FEFF7FB, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
};

int tbl_mask_double[512] = {
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F9FCFE7, 0x3F9FCFE7, 0x3F9FCFE7, 0x3F93C9E4, 0x3F9FCFE7, 0x3F8BC5E2, 0x3F87C3E1, 0x3F9FCFE7,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F5FAFD7, 0x3F5FAFD7, 0x3F5FAFD7, 0x3F53A9D4, 0x3F5FAFD7, 0x3F4BA5D2, 0x3F47A3D1, 0x3F5FAFD7,
  0x3F3F9FCF, 0x3F3F9FCF, 0x3F3F9FCF, 0x3F3399CC, 0x3F3F9FCF, 0x3F2B95CA, 0x3F2793C9, 0x3F3F9FCF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F9FCFE7, 0x3F9FCFE7, 0x3F9FCFE7, 0x3F93C9E4, 0x3F9FCFE7, 0x3F8BC5E2, 0x3F87C3E1, 0x3F9FCFE7,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F5FAFD7, 0x3F5FAFD7, 0x3F5FAFD7, 0x3F53A9D4, 0x3F5FAFD7, 0x3F4BA5D2, 0x3F47A3D1, 0x3F5FAFD7,
  0x3F3F9FCF, 0x3F3F9FCF, 0x3F3F9FCF, 0x3F3399CC, 0x3F3F9FCF, 0x3F2B95CA, 0x3F2793C9, 0x3F3F9FCF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F9FCFE7, 0x3F9FCFE7, 0x3F9FCFE7, 0x3F93C9E4, 0x3F9FCFE7, 0x3F8BC5E2, 0x3F87C3E1, 0x3F9FCFE7,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F5FAFD7, 0x3F5FAFD7, 0x3F5FAFD7, 0x3F53A9D4, 0x3F5FAFD7, 0x3F4BA5D2, 0x3F47A3D1, 0x3F5FAFD7,
  0x3F3F9FCF, 0x3F3F9FCF, 0x3F3F9FCF, 0x3F3399CC, 0x3F3F9FCF, 0x3F2B95CA, 0x3F2793C9, 0x3F3F9FCF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3CFE7F3F, 0x3CFE7F3F, 0x3CFE7F3F, 0x3CF2793C, 0x3CFE7F3F, 0x3CEA753A, 0x3CE67339, 0x3CFE7F3F,
  0x3CFE7F3F, 0x3CFE7F3F, 0x3CFE7F3F, 0x3CF2793C, 0x3CFE7F3F, 0x3CEA753A, 0x3CE67339, 0x3CFE7F3F,
  0x3CFE7F3F, 0x3CFE7F3F, 0x3CFE7F3F, 0x3CF2793C, 0x3CFE7F3F, 0x3CEA753A, 0x3CE67339, 0x3CFE7F3F,
  0x3C9E4F27, 0x3C9E4F27, 0x3C9E4F27, 0x3C924924, 0x3C9E4F27, 0x3C8A4522, 0x3C864321, 0x3C9E4F27,
  0x3CFE7F3F, 0x3CFE7F3F, 0x3CFE7F3F, 0x3CF2793C, 0x3CFE7F3F, 0x3CEA753A, 0x3CE67339, 0x3CFE7F3F,
  0x3C5E2F17, 0x3C5E2F17, 0x3C5E2F17, 0x3C522914, 0x3C5E2F17, 0x3C4A2512, 0x3C462311, 0x3C5E2F17,
  0x3C3E1F0F, 0x3C3E1F0F, 0x3C3E1F0F, 0x3C32190C, 0x3C3E1F0F, 0x3C2A150A, 0x3C261309, 0x3C3E1F0F,
  0x3CFE7F3F, 0x3CFE7F3F, 0x3CFE7F3F, 0x3CF2793C, 0x3CFE7F3F, 0x3CEA753A, 0x3CE67339, 0x3CFE7F3F,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F9FCFE7, 0x3F9FCFE7, 0x3F9FCFE7, 0x3F93C9E4, 0x3F9FCFE7, 0x3F8BC5E2, 0x3F87C3E1, 0x3F9FCFE7,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F5FAFD7, 0x3F5FAFD7, 0x3F5FAFD7, 0x3F53A9D4, 0x3F5FAFD7, 0x3F4BA5D2, 0x3F47A3D1, 0x3F5FAFD7,
  0x3F3F9FCF, 0x3F3F9FCF, 0x3F3F9FCF, 0x3F3399CC, 0x3F3F9FCF, 0x3F2B95CA, 0x3F2793C9, 0x3F3F9FCF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3AFD7EBF, 0x3AFD7EBF, 0x3AFD7EBF, 0x3AF178BC, 0x3AFD7EBF, 0x3AE974BA, 0x3AE572B9, 0x3AFD7EBF,
  0x3AFD7EBF, 0x3AFD7EBF, 0x3AFD7EBF, 0x3AF178BC, 0x3AFD7EBF, 0x3AE974BA, 0x3AE572B9, 0x3AFD7EBF,
  0x3AFD7EBF, 0x3AFD7EBF, 0x3AFD7EBF, 0x3AF178BC, 0x3AFD7EBF, 0x3AE974BA, 0x3AE572B9, 0x3AFD7EBF,
  0x3A9D4EA7, 0x3A9D4EA7, 0x3A9D4EA7, 0x3A9148A4, 0x3A9D4EA7, 0x3A8944A2, 0x3A8542A1, 0x3A9D4EA7,
  0x3AFD7EBF, 0x3AFD7EBF, 0x3AFD7EBF, 0x3AF178BC, 0x3AFD7EBF, 0x3AE974BA, 0x3AE572B9, 0x3AFD7EBF,
  0x3A5D2E97, 0x3A5D2E97, 0x3A5D2E97, 0x3A512894, 0x3A5D2E97, 0x3A492492, 0x3A452291, 0x3A5D2E97,
  0x3A3D1E8F, 0x3A3D1E8F, 0x3A3D1E8F, 0x3A31188C, 0x3A3D1E8F, 0x3A29148A, 0x3A251289, 0x3A3D1E8F,
  0x3AFD7EBF, 0x3AFD7EBF, 0x3AFD7EBF, 0x3AF178BC, 0x3AFD7EBF, 0x3AE974BA, 0x3AE572B9, 0x3AFD7EBF,
  0x39FCFE7F, 0x39FCFE7F, 0x39FCFE7F, 0x39F0F87C, 0x39FCFE7F, 0x39E8F47A, 0x39E4F279, 0x39FCFE7F,
  0x39FCFE7F, 0x39FCFE7F, 0x39FCFE7F, 0x39F0F87C, 0x39FCFE7F, 0x39E8F47A, 0x39E4F279, 0x39FCFE7F,
  0x39FCFE7F, 0x39FCFE7F, 0x39FCFE7F, 0x39F0F87C, 0x39FCFE7F, 0x39E8F47A, 0x39E4F279, 0x39FCFE7F,
  0x399CCE67, 0x399CCE67, 0x399CCE67, 0x3990C864, 0x399CCE67, 0x3988C462, 0x3984C261, 0x399CCE67,
  0x39FCFE7F, 0x39FCFE7F, 0x39FCFE7F, 0x39F0F87C, 0x39FCFE7F, 0x39E8F47A, 0x39E4F279, 0x39FCFE7F,
  0x395CAE57, 0x395CAE57, 0x395CAE57, 0x3950A854, 0x395CAE57, 0x3948A452, 0x3944A251, 0x395CAE57,
  0x393C9E4F, 0x393C9E4F, 0x393C9E4F, 0x3930984C, 0x393C9E4F, 0x3928944A, 0x39249249, 0x393C9E4F,
  0x39FCFE7F, 0x39FCFE7F, 0x39FCFE7F, 0x39F0F87C, 0x39FCFE7F, 0x39E8F47A, 0x39E4F279, 0x39FCFE7F,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F9FCFE7, 0x3F9FCFE7, 0x3F9FCFE7, 0x3F93C9E4, 0x3F9FCFE7, 0x3F8BC5E2, 0x3F87C3E1, 0x3F9FCFE7,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
  0x3F5FAFD7, 0x3F5FAFD7, 0x3F5FAFD7, 0x3F53A9D4, 0x3F5FAFD7, 0x3F4BA5D2, 0x3F47A3D1, 0x3F5FAFD7,
  0x3F3F9FCF, 0x3F3F9FCF, 0x3F3F9FCF, 0x3F3399CC, 0x3F3F9FCF, 0x3F2B95CA, 0x3F2793C9, 0x3F3F9FCF,
  0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FF3F9FC, 0x3FFFFFFF, 0x3FEBF5FA, 0x3FE7F3F9, 0x3FFFFFFF,
};

int tbl_row_mask[8] = {
  0x7FFFFFF, 0x7FFFE00, 0x7FC01FF, 0x7FC0000, 0x3FFFF, 0x3FE00, 0x1FF, 0x0,
};

bool tbl_uniq_flag[8] = {
  true, true, true, false, true, false, false, false,
};

byte tbl_shrink_mask[512] = {
  0x0, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1, 0x1,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x2, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3, 0x3,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x4, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
  0x6, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7, 0x7,
};

int tbl_row_uniq[512] = {
  0x7, 0x6, 0x6, 0x6, 0x6, 0x6, 0x6, 0x6,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x5, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4, 0x4,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x3, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2, 0x2,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
};

int tbl_complex_mask[512] = {
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x3FFFFFFF, 0x3F1C71C0, 0x381FF1C0, 0x3F1FF1C0,
  0x0, 0x0, 0x0, 0x0, 0x38FC71C0, 0x3FFC71C0, 0x3FFFF1C0, 0x3FFFF1C0,
  0x0, 0x0, 0x3FFFFFFF, 0x38FF8038, 0x0, 0x0, 0x381FF038, 0x38FFF038,
  0x0, 0x0, 0x3F1F8038, 0x3FFF8038, 0x0, 0x0, 0x3FFFF038, 0x3FFFF038,
  0x0, 0x0, 0x381F81F8, 0x3FFF81F8, 0x381C71F8, 0x3FFC71F8, 0x3FFFFFFF, 0x3FFFF1F8,
  0x0, 0x0, 0x3F1F81F8, 0x3FFF81F8, 0x38FC71F8, 0x3FFC71F8, 0x3FFFF1F8, 0x3FFFF1F8,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x3FFFFFFF, 0x38E38FC0, 0x3FE00FC0, 0x3FE38FC0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x38FC0FC0, 0x3FFF8FC0, 0x3FFC0FC0, 0x3FFF8FC0,
  0x0, 0x3FFFFFFF, 0x0, 0x38FF8007, 0x0, 0x38E38E07, 0x0, 0x38FF8E07,
  0x0, 0x38E381C7, 0x0, 0x3FFF81C7, 0x38E00FC7, 0x3FFFFFFF, 0x3FFC0FC7, 0x3FFF8FC7,
  0x0, 0x3FE38007, 0x0, 0x3FFF8007, 0x0, 0x3FFF8E07, 0x0, 0x3FFF8E07,
  0x0, 0x3FE381C7, 0x0, 0x3FFF81C7, 0x38FC0FC7, 0x3FFF8FC7, 0x3FFC0FC7, 0x3FFF8FC7,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x38E07FC0, 0x38E3FFC0, 0x3FE3FFC0, 0x3FE3FFC0,
  0x0, 0x0, 0x0, 0x0, 0x381C7FC0, 0x3F1FFFC0, 0x381FFFC0, 0x3F1FFFC0,
  0x0, 0x0, 0x0, 0x0, 0x3FFFFFFF, 0x3FFFFFC0, 0x3FFFFFC0, 0x3FFFFFC0,
  0x0, 0x38E3803F, 0x381F803F, 0x3FFFFFFF, 0x0, 0x38E3FE3F, 0x381FFE3F, 0x38FFFE3F,
  0x0, 0x38E381FF, 0x3F1F81FF, 0x3FFF81FF, 0x38E07FFF, 0x38E3FFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x0, 0x3FE381FF, 0x381F81FF, 0x3FFF81FF, 0x381C7FFF, 0x3FFFFFFF, 0x381FFFFF, 0x3FFFFFFF,
  0x0, 0x3FE381FF, 0x3F1F81FF, 0x3FFF81FF, 0x38FC7FFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x3FFFFFFF, 0x3F007E38, 0x0, 0x0, 0x3FE00E38, 0x3FE07E38,
  0x0, 0x3FFFFFFF, 0x0, 0x3F007E07, 0x0, 0x3F1C7007, 0x0, 0x3F1C7E07,
  0x0, 0x3F00703F, 0x3F000E3F, 0x3FFFFFFF, 0x0, 0x3FFC703F, 0x3FFC0E3F, 0x3FFC7E3F,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x3F1C0E38, 0x3FFC7E38, 0x0, 0x0, 0x3FFC0E38, 0x3FFC7E38,
  0x0, 0x3FE07007, 0x0, 0x3FFC7E07, 0x0, 0x3FFC7007, 0x0, 0x3FFC7E07,
  0x0, 0x3FE0703F, 0x3F1C0E3F, 0x3FFC7E3F, 0x0, 0x3FFC703F, 0x3FFC0E3F, 0x3FFC7E3F,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x3F038E38, 0x3F03FE38, 0x0, 0x0, 0x3FE3FE38, 0x3FE3FE38,
  0x0, 0x3F0071C7, 0x0, 0x3F03FFC7, 0x381C71C7, 0x3FFFFFFF, 0x381FFFC7, 0x3F1FFFC7,
  0x0, 0x3F0071FF, 0x3F038FFF, 0x3F03FFFF, 0x38FC71FF, 0x3FFC71FF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x0, 0x0, 0x381F8E38, 0x38FFFE38, 0x0, 0x0, 0x381FFE38, 0x38FFFE38,
  0x0, 0x0, 0x3FFFFFFF, 0x3FFFFE38, 0x0, 0x0, 0x3FFFFE38, 0x3FFFFE38,
  0x0, 0x3FE071FF, 0x381F8FFF, 0x3FFFFFFF, 0x381C71FF, 0x3FFC71FF, 0x381FFFFF, 0x3FFFFFFF,
  0x0, 0x3FE071FF, 0x3F1F8FFF, 0x3FFFFFFF, 0x38FC71FF, 0x3FFC71FF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x3F000FF8, 0x3F03FFF8, 0x38E00FF8, 0x38E3FFF8, 0x3FFFFFFF, 0x3FE3FFF8,
  0x0, 0x3F03F007, 0x0, 0x3F03FE07, 0x0, 0x3F1FFE07, 0x0, 0x3F1FFE07,
  0x0, 0x3F03F1FF, 0x3F000FFF, 0x3F03FFFF, 0x38FC0FFF, 0x3FFFFFFF, 0x3FFC0FFF, 0x3FFFFFFF,
  0x0, 0x38E3F007, 0x0, 0x38FFFE07, 0x0, 0x38E3FE07, 0x0, 0x38FFFE07,
  0x0, 0x38E3F1FF, 0x3F1C0FFF, 0x3FFFFFFF, 0x38E00FFF, 0x38E3FFFF, 0x3FFC0FFF, 0x3FFFFFFF,
  0x0, 0x3FFFFFFF, 0x0, 0x3FFFFE07, 0x0, 0x3FFFFE07, 0x0, 0x3FFFFE07,
  0x0, 0x3FE3F1FF, 0x3F1C0FFF, 0x3FFFFFFF, 0x38FC0FFF, 0x3FFFFFFF, 0x3FFC0FFF, 0x3FFFFFFF,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x3F038FF8, 0x3F03FFF8, 0x38E07FF8, 0x38E3FFF8, 0x3FE3FFF8, 0x3FE3FFF8,
  0x0, 0x3F03F1C7, 0x0, 0x3F03FFC7, 0x381C7FC7, 0x3F1FFFC7, 0x381FFFC7, 0x3F1FFFC7,
  0x0, 0x3F03F1FF, 0x3F038FFF, 0x3F03FFFF, 0x38FC7FFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x0, 0x38E3F03F, 0x381F8E3F, 0x38FFFE3F, 0x0, 0x38E3FE3F, 0x381FFE3F, 0x38FFFE3F,
  0x0, 0x38E3F1FF, 0x3F1F8FFF, 0x3FFFFFFF, 0x38E07FFF, 0x38E3FFFF, 0x3FFFFFFF, 0x3FFFFFFF,
  0x0, 0x3FE3F1FF, 0x381F8FFF, 0x3FFFFFFF, 0x381C7FFF, 0x3FFFFFFF, 0x381FFFFF, 0x3FFFFFFF,
  0x0, 0x3FE3F1FF, 0x3F1F8FFF, 0x3FFFFFFF, 0x38FC7FFF, 0x3FFFFFFF, 0x3FFFFFFF, 0x3FFFFFFF,
};

int tbl_column_single[512] = {
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x1FF, 0x1FF, 0x1B6, 0x1FF, 0x1B6, 0x1B6, 0x1B6,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x16D, 0x16D, 0x124, 0x16D, 0x124, 0x124, 0x124,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0xDB, 0xDB, 0x92, 0xDB, 0x92, 0x92, 0x92,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
  0x0, 0x49, 0x49, 0x0, 0x49, 0x0, 0x0, 0x0,
};

int tbl_shrink_single[512] = {
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x54, 0x54, 0x54, 0x54,
  0x0, 0x0, 0x0, 0x0, 0x54, 0x54, 0x54, 0x54,
  0x0, 0x0, 0x62, 0x62, 0x0, 0x0, 0x62, 0x62,
  0x0, 0x0, 0x62, 0x62, 0x0, 0x0, 0x62, 0x62,
  0x0, 0x0, 0x62, 0x62, 0x54, 0x54, 0x40, 0x40,
  0x0, 0x0, 0x62, 0x62, 0x54, 0x54, 0x40, 0x40,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x8C, 0x8C, 0x8C, 0x8C,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x8C, 0x8C, 0x8C, 0x8C,
  0x0, 0xA1, 0x0, 0xA1, 0x0, 0xA1, 0x0, 0xA1,
  0x0, 0xA1, 0x0, 0xA1, 0x8C, 0x80, 0x8C, 0x80,
  0x0, 0xA1, 0x0, 0xA1, 0x0, 0xA1, 0x0, 0xA1,
  0x0, 0xA1, 0x0, 0xA1, 0x8C, 0x80, 0x8C, 0x80,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x8C, 0x8C, 0x8C, 0x8C,
  0x0, 0x0, 0x0, 0x0, 0x54, 0x54, 0x54, 0x54,
  0x0, 0x0, 0x0, 0x0, 0x4, 0x4, 0x4, 0x4,
  0x0, 0xA1, 0x62, 0x20, 0x0, 0xA1, 0x62, 0x20,
  0x0, 0xA1, 0x62, 0x20, 0x8C, 0x80, 0x0, 0x0,
  0x0, 0xA1, 0x62, 0x20, 0x54, 0x0, 0x40, 0x0,
  0x0, 0xA1, 0x62, 0x20, 0x4, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x10A, 0x10A, 0x0, 0x0, 0x10A, 0x10A,
  0x0, 0x111, 0x0, 0x111, 0x0, 0x111, 0x0, 0x111,
  0x0, 0x111, 0x10A, 0x100, 0x0, 0x111, 0x10A, 0x100,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x10A, 0x10A, 0x0, 0x0, 0x10A, 0x10A,
  0x0, 0x111, 0x0, 0x111, 0x0, 0x111, 0x0, 0x111,
  0x0, 0x111, 0x10A, 0x100, 0x0, 0x111, 0x10A, 0x100,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x10A, 0x10A, 0x0, 0x0, 0x10A, 0x10A,
  0x0, 0x111, 0x0, 0x111, 0x54, 0x10, 0x54, 0x10,
  0x0, 0x111, 0x10A, 0x100, 0x54, 0x10, 0x0, 0x0,
  0x0, 0x0, 0x62, 0x62, 0x0, 0x0, 0x62, 0x62,
  0x0, 0x0, 0x2, 0x2, 0x0, 0x0, 0x2, 0x2,
  0x0, 0x111, 0x62, 0x0, 0x54, 0x10, 0x40, 0x0,
  0x0, 0x111, 0x2, 0x0, 0x54, 0x10, 0x0, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x10A, 0x10A, 0x8C, 0x8C, 0x8, 0x8,
  0x0, 0x111, 0x0, 0x111, 0x0, 0x111, 0x0, 0x111,
  0x0, 0x111, 0x10A, 0x100, 0x8C, 0x0, 0x8, 0x0,
  0x0, 0xA1, 0x0, 0xA1, 0x0, 0xA1, 0x0, 0xA1,
  0x0, 0xA1, 0x10A, 0x0, 0x8C, 0x80, 0x8, 0x0,
  0x0, 0x1, 0x0, 0x1, 0x0, 0x1, 0x0, 0x1,
  0x0, 0x1, 0x10A, 0x0, 0x8C, 0x0, 0x8, 0x0,
  0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
  0x0, 0x0, 0x10A, 0x10A, 0x8C, 0x8C, 0x8, 0x8,
  0x0, 0x111, 0x0, 0x111, 0x54, 0x10, 0x54, 0x10,
  0x0, 0x111, 0x10A, 0x100, 0x4, 0x0, 0x0, 0x0,
  0x0, 0xA1, 0x62, 0x20, 0x0, 0xA1, 0x62, 0x20,
  0x0, 0xA1, 0x2, 0x0, 0x8C, 0x80, 0x0, 0x0,
  0x0, 0x1, 0x62, 0x0, 0x54, 0x0, 0x40, 0x0,
  0x0, 0x1, 0x2, 0x0, 0x4, 0x0, 0x0, 0x0,
};

typedef struct {
  int full_mask[27];
  int block;
  int mask;
  int left;
} game_t;

typedef struct {
  byte board[81 + 1];
  game_t games[60];
  int index;
  int block_mask[27];
  int block_mask_sum[3];
  int full_mask[27];
  int comp_f[27];
} sudoku_t;

static void sudoku_init(sudoku_t *sudoku) {
  int i;

  sudoku->index = 1;
  sudoku->block_mask_sum[0] = sudoku->block_mask_sum[1] = sudoku->block_mask_sum[2] = 0;
  for (i = 0; i < 27; i++) {
    sudoku->comp_f[i] = sudoku->full_mask[i] = BIT_SET_30;
    sudoku->block_mask[i] = 0;
  }
  for (i = 80; i >= 0; i--) {
    if (sudoku->board[i] == '0')
      continue;

    int b = tbl_mult3[sudoku->board[i] - '1'] + tbl_board_block[i];
    sudoku->block_mask_sum[tbl_board_block[i]] |= tbl_board_block_mask[i];
    sudoku->block_mask[b] |= tbl_board_block_mask[i];
    sudoku->full_mask[b] &= tbl_self_mask[i];
    sudoku->full_mask[tbl_another1[b]] &= tbl_other_mask[i];
    sudoku->full_mask[tbl_another2[b]] &= tbl_other_mask[i];
  }
  sudoku->block_mask_sum[0] ^= BIT_SET_30;
  sudoku->block_mask_sum[1] ^= BIT_SET_30;
  sudoku->block_mask_sum[2] ^= BIT_SET_30;
  NORF(0)
  NORF(3)
  NORF(6)
  NORF(9)
  NORF(12)
  NORF(15)
  NORF(18)
  NORF(21)
  NORF(24)
  NORF(1)
  NORF(4)
  NORF(7)
  NORF(10)
  NORF(13)
  NORF(16)
  NORF(19)
  NORF(22)
  NORF(25)
  NORF(2)
  NORF(5)
  NORF(8)
  NORF(11)
  NORF(14)
  NORF(17)
  NORF(20)
  NORF(23)
  NORF(26)
}

static void guess(sudoku_t *sudoku, int (*select)(int)) {
  int line = 0;
  int i;
  int least = 10;
  int n_0;

  for (i = 0; i < 21; i++) {
    if (tbl_uniq_flag[sudoku->full_mask[i] >> 27])
      continue;

    sudoku->games[sudoku->index].block = i;
    if (tbl_number_one[HIGH_9_BIT(sudoku->full_mask[i])] == 2) {
      line = 2;
      goto found_least;
    }
    if (tbl_number_one[MID_9_BIT(sudoku->full_mask[i])] == 2) {
      line = 1;
      goto found_least;
    }
    if (tbl_number_one[LOW_9_BIT(sudoku->full_mask[i])] == 2) {
      line = 0;
      goto found_least;
    }
  }
  for (i = 0; i < 27; i++) {
    if (sudoku->full_mask[i] & 0x08000000) {
      n_0 = tbl_number_one[LOW_9_BIT(sudoku->full_mask[i])];
      if (least > n_0) {
        sudoku->games[sudoku->index].block = i;
        line = 0;
        if ((least = n_0) == 2)
          goto found_least;
      }
    }
    if (sudoku->full_mask[i] & 0x10000000) {
      n_0 = tbl_number_one[MID_9_BIT(sudoku->full_mask[i])];
      if (least > n_0) {
        sudoku->games[sudoku->index].block = i;
        line = 1;
        if ((least = n_0) == 2)
          goto found_least;
      }
    }
    if (sudoku->full_mask[i] & 0x20000000) {
      n_0 = tbl_number_one[HIGH_9_BIT(sudoku->full_mask[i])];
      if (least > n_0) {
        sudoku->games[sudoku->index].block = i;
        line = 2;
        if ((least = n_0) == 2)
          goto found_least;
      }
    }
  }
found_least:
  sudoku->games[sudoku->index].left = sudoku->full_mask[sudoku->games[sudoku->index].block] & T[line];
  sudoku->full_mask[sudoku->games[sudoku->index].block] ^= sudoku->games[sudoku->index].left;
  SAVF(0)
  SAVF(1)
  SAVF(2)
  SAVF(3)
  SAVF(4)
  SAVF(5)
  SAVF(6)
  SAVF(7)
  SAVF(8)
  SAVF(9)
  SAVF(10)
  SAVF(11)
  SAVF(12)
  SAVF(13)
  SAVF(14)
  SAVF(15)
  SAVF(16)
  SAVF(17)
  SAVF(18)
  SAVF(19)
  SAVF(20)
  SAVF(21)
  SAVF(22)
  SAVF(23)
  SAVF(24)
  SAVF(25)
  SAVF(26)
  sudoku->games[sudoku->index].mask = (*select)(sudoku->games[sudoku->index].left);
  sudoku->games[sudoku->index].left ^= sudoku->games[sudoku->index].mask;
  sudoku->full_mask[sudoku->games[sudoku->index].block] ^= sudoku->games[sudoku->index].mask;
  sudoku->index++;
}

static bool rollback(sudoku_t *sudoku, int (*select)(int)) {
  if (!--sudoku->index)
    return false;
  RESF(0)
  RESF(1)
  RESF(2)
  RESF(3)
  RESF(4)
  RESF(5)
  RESF(6)
  RESF(7)
  RESF(8)
  RESF(9)
  RESF(10)
  RESF(11)
  RESF(12)
  RESF(13)
  RESF(14)
  RESF(15)
  RESF(16)
  RESF(17)
  RESF(18)
  RESF(19)
  RESF(20)
  RESF(21)
  RESF(22)
  RESF(23)
  RESF(24)
  RESF(25)
  RESF(26)
  sudoku->games[sudoku->index].mask = (*select)(sudoku->games[sudoku->index].left);
  sudoku->full_mask[sudoku->games[sudoku->index].block] ^= sudoku->games[sudoku->index].mask;
  sudoku->index += (sudoku->games[sudoku->index].left ^= sudoku->games[sudoku->index].mask) != 0;

  return true;
}

static bool update(sudoku_t *sudoku) {
  int shrink = ~0, l_s, l_c1, l_c2;
  while (shrink) {
    shrink = 0;
    if (sudoku->comp_f[0] != sudoku->full_mask[0]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[0]);
      if ((sudoku->full_mask[0] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[0]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[1]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[2]);
      sudoku->full_mask[2] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[1] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[0] >> 27) != l_s) {
        sudoku->full_mask[0] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[0] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[0] = sudoku->full_mask[0];
    }
    if (sudoku->comp_f[1] != sudoku->full_mask[1]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[1]);
      if ((sudoku->full_mask[1] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[1]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[0]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[2]);
      sudoku->full_mask[2] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[0] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[1] >> 27) != l_s) {
        sudoku->full_mask[1] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[1] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[1] = sudoku->full_mask[1];
    }
    if (sudoku->comp_f[2] != sudoku->full_mask[2]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[2]);
      if ((sudoku->full_mask[2] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[2]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[0]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[1]);
      sudoku->full_mask[1] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[0] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[2] >> 27) != l_s) {
        sudoku->full_mask[2] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[2] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[2] = sudoku->full_mask[2];
    }
    if (sudoku->comp_f[3] != sudoku->full_mask[3]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[3]);
      if ((sudoku->full_mask[3] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[3]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[4]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[5]);
      sudoku->full_mask[5] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[4] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[3] >> 27) != l_s) {
        sudoku->full_mask[3] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[3] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[3] = sudoku->full_mask[3];
    }
    if (sudoku->comp_f[4] != sudoku->full_mask[4]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[4]);
      if ((sudoku->full_mask[4] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[4]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[3]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[5]);
      sudoku->full_mask[5] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[3] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[4] >> 27) != l_s) {
        sudoku->full_mask[4] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[4] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[4] = sudoku->full_mask[4];
    }
    if (sudoku->comp_f[5] != sudoku->full_mask[5]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[5]);
      if ((sudoku->full_mask[5] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[5]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[3]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[4]);
      sudoku->full_mask[4] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[3] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[5] >> 27) != l_s) {
        sudoku->full_mask[5] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[5] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[5] = sudoku->full_mask[5];
    }
    if (sudoku->comp_f[6] != sudoku->full_mask[6]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[6]);
      if ((sudoku->full_mask[6] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[6]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[7]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[8]);
      sudoku->full_mask[8] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[7] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[6] >> 27) != l_s) {
        sudoku->full_mask[6] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[6] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[6] = sudoku->full_mask[6];
    }
    if (sudoku->comp_f[7] != sudoku->full_mask[7]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[7]);
      if ((sudoku->full_mask[7] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[7]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[6]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[8]);
      sudoku->full_mask[8] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[6] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[7] >> 27) != l_s) {
        sudoku->full_mask[7] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[7] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[7] = sudoku->full_mask[7];
    }
    if (sudoku->comp_f[8] != sudoku->full_mask[8]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[8]);
      if ((sudoku->full_mask[8] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[8]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[6]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[7]);
      sudoku->full_mask[7] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[6] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[8] >> 27) != l_s) {
        sudoku->full_mask[8] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[8] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[8] = sudoku->full_mask[8];
    }
    if (sudoku->comp_f[9] != sudoku->full_mask[9]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[9]);
      if ((sudoku->full_mask[9] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[9]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[10]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[11]);
      sudoku->full_mask[11] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[10] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[9] >> 27) != l_s) {
        sudoku->full_mask[9] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[9] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[9] = sudoku->full_mask[9];
    }
    if (sudoku->comp_f[10] != sudoku->full_mask[10]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[10]);
      if ((sudoku->full_mask[10] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[10]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[9]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[11]);
      sudoku->full_mask[11] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[9] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[10] >> 27) != l_s) {
        sudoku->full_mask[10] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[10] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[10] = sudoku->full_mask[10];
    }
    if (sudoku->comp_f[11] != sudoku->full_mask[11]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[11]);
      if ((sudoku->full_mask[11] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[11]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[9]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[10]);
      sudoku->full_mask[10] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[9] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[11] >> 27) != l_s) {
        sudoku->full_mask[11] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[11] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[11] = sudoku->full_mask[11];
    }
    if (sudoku->comp_f[12] != sudoku->full_mask[12]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[12]);
      if ((sudoku->full_mask[12] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[12]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[13]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[14]);
      sudoku->full_mask[14] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[13] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[12] >> 27) != l_s) {
        sudoku->full_mask[12] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[12] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[12] = sudoku->full_mask[12];
    }
    if (sudoku->comp_f[13] != sudoku->full_mask[13]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[13]);
      if ((sudoku->full_mask[13] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[13]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[12]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[14]);
      sudoku->full_mask[14] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[12] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[13] >> 27) != l_s) {
        sudoku->full_mask[13] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[13] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[13] = sudoku->full_mask[13];
    }
    if (sudoku->comp_f[14] != sudoku->full_mask[14]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[14]);
      if ((sudoku->full_mask[14] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[14]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[12]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[13]);
      sudoku->full_mask[13] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[12] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[14] >> 27) != l_s) {
        sudoku->full_mask[14] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[14] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[14] = sudoku->full_mask[14];
    }
    if (sudoku->comp_f[15] != sudoku->full_mask[15]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[15]);
      if ((sudoku->full_mask[15] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[15]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[16]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[17]);
      sudoku->full_mask[17] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[16] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[15] >> 27) != l_s) {
        sudoku->full_mask[15] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[15] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[15] = sudoku->full_mask[15];
    }
    if (sudoku->comp_f[16] != sudoku->full_mask[16]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[16]);
      if ((sudoku->full_mask[16] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[16]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[15]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[17]);
      sudoku->full_mask[17] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[15] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[16] >> 27) != l_s) {
        sudoku->full_mask[16] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[16] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[16] = sudoku->full_mask[16];
    }
    if (sudoku->comp_f[17] != sudoku->full_mask[17]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[17]);
      if ((sudoku->full_mask[17] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[17]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[15]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[16]);
      sudoku->full_mask[16] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[15] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[17] >> 27) != l_s) {
        sudoku->full_mask[17] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[17] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[17] = sudoku->full_mask[17];
    }
    if (sudoku->comp_f[18] != sudoku->full_mask[18]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[18]);
      if ((sudoku->full_mask[18] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[18]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[19]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[20]);
      sudoku->full_mask[20] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[19] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[18] >> 27) != l_s) {
        sudoku->full_mask[18] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[18] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[21], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[18] = sudoku->full_mask[18];
    }
    if (sudoku->comp_f[19] != sudoku->full_mask[19]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[19]);
      if ((sudoku->full_mask[19] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[19]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[18]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[20]);
      sudoku->full_mask[20] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[18] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[19] >> 27) != l_s) {
        sudoku->full_mask[19] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[19] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[22], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[19] = sudoku->full_mask[19];
    }
    if (sudoku->comp_f[20] != sudoku->full_mask[20]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[20]);
      if ((sudoku->full_mask[20] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[20]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[18]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[19]);
      sudoku->full_mask[19] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[18] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[20] >> 27) != l_s) {
        sudoku->full_mask[20] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[20] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[23], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[20] = sudoku->full_mask[20];
    }
    if (sudoku->comp_f[21] != sudoku->full_mask[21]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[21]);
      if ((sudoku->full_mask[21] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[21]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[22]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[23]);
      sudoku->full_mask[23] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[22] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[21] >> 27) != l_s) {
        sudoku->full_mask[21] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[21] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[24], l_s);
      }
      sudoku->comp_f[21] = sudoku->full_mask[21];
    }
    if (sudoku->comp_f[22] != sudoku->full_mask[22]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[22]);
      if ((sudoku->full_mask[22] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[22]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[21]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[23]);
      sudoku->full_mask[23] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[21] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[22] >> 27) != l_s) {
        sudoku->full_mask[22] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[22] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[25], l_s);
      }
      sudoku->comp_f[22] = sudoku->full_mask[22];
    }
    if (sudoku->comp_f[23] != sudoku->full_mask[23]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[23]);
      if ((sudoku->full_mask[23] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[23]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[21]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[22]);
      sudoku->full_mask[22] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[21] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[23] >> 27) != l_s) {
        sudoku->full_mask[23] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[23] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[26], l_s);
      }
      sudoku->comp_f[23] = sudoku->full_mask[23];
    }
    if (sudoku->comp_f[24] != sudoku->full_mask[24]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[24]);
      if ((sudoku->full_mask[24] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[24]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[25]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[26]);
      sudoku->full_mask[26] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[25] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[24] >> 27) != l_s) {
        sudoku->full_mask[24] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[24] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[0], l_s);
        AN(sudoku->full_mask[3], l_s);
        AN(sudoku->full_mask[6], l_s);
        AN(sudoku->full_mask[9], l_s);
        AN(sudoku->full_mask[12], l_s);
        AN(sudoku->full_mask[15], l_s);
        AN(sudoku->full_mask[18], l_s);
        AN(sudoku->full_mask[21], l_s);
      }
      sudoku->comp_f[24] = sudoku->full_mask[24];
    }
    if (sudoku->comp_f[25] != sudoku->full_mask[25]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[25]);
      if ((sudoku->full_mask[25] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[25]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[24]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[26]);
      sudoku->full_mask[26] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[24] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[25] >> 27) != l_s) {
        sudoku->full_mask[25] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[25] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[1], l_s);
        AN(sudoku->full_mask[4], l_s);
        AN(sudoku->full_mask[7], l_s);
        AN(sudoku->full_mask[10], l_s);
        AN(sudoku->full_mask[13], l_s);
        AN(sudoku->full_mask[16], l_s);
        AN(sudoku->full_mask[19], l_s);
        AN(sudoku->full_mask[22], l_s);
      }
      sudoku->comp_f[25] = sudoku->full_mask[25];
    }
    if (sudoku->comp_f[26] != sudoku->full_mask[26]) {
      shrink = FULL_TO_SHRINK(sudoku->full_mask[26]);
      if ((sudoku->full_mask[26] &= tbl_complex_mask[shrink]) == 0)
        return false;
      l_s = FULL_TO_COLUMN(sudoku->full_mask[26]);
      l_c1 = l_s | FULL_TO_COLUMN(sudoku->full_mask[24]);
      l_c2 = l_s | FULL_TO_COLUMN(sudoku->full_mask[25]);
      sudoku->full_mask[25] &= tbl_mask_single[l_s] & tbl_mask_double[l_c1];
      sudoku->full_mask[24] &= tbl_mask_single[l_s] & tbl_mask_double[l_c2];
      l_s = tbl_row_uniq[tbl_shrink_single[shrink] & tbl_column_single[l_s]];
      if ((sudoku->full_mask[26] >> 27) != l_s) {
        sudoku->full_mask[26] &= l_s << 27 | BIT_SET_27;
        l_s = ~(sudoku->full_mask[26] & tbl_row_mask[l_s]);
        AN(sudoku->full_mask[2], l_s);
        AN(sudoku->full_mask[5], l_s);
        AN(sudoku->full_mask[8], l_s);
        AN(sudoku->full_mask[11], l_s);
        AN(sudoku->full_mask[14], l_s);
        AN(sudoku->full_mask[17], l_s);
        AN(sudoku->full_mask[20], l_s);
        AN(sudoku->full_mask[23], l_s);
      }
      sudoku->comp_f[26] = sudoku->full_mask[26];
    }
  }
  return true;
}

static int calculate(sudoku_t *sudoku, int limit, char *solution, int (*select)(int)) {
  int n = 0;
  while (true) {
    if (update(sudoku)) {
      if ((sudoku->full_mask[18] | sudoku->full_mask[22] | sudoku->full_mask[26]) > BIT_SET_27
          || (sudoku->full_mask[19] | sudoku->full_mask[23] | sudoku->full_mask[24]) > BIT_SET_27
          || (sudoku->full_mask[20] | sudoku->full_mask[21] | sudoku->full_mask[25]) > BIT_SET_27
          || (sudoku->full_mask[15] | sudoku->full_mask[16] | sudoku->full_mask[17]) > BIT_SET_27
          || (sudoku->full_mask[12] | sudoku->full_mask[13] | sudoku->full_mask[14]) > BIT_SET_27
          || (sudoku->full_mask[9] | sudoku->full_mask[10] | sudoku->full_mask[11]) > BIT_SET_27
          || (sudoku->full_mask[6] | sudoku->full_mask[7] | sudoku->full_mask[8]) > BIT_SET_27
          || (sudoku->full_mask[3] | sudoku->full_mask[4] | sudoku->full_mask[5]) > BIT_SET_27) {
        guess(sudoku, select);
        continue;
      }
      ++n;
      if (solution && n == 1) {
        for (int idx = 0; idx < 81; ++idx) {
          int mask = tbl_board_block_mask[idx];
          int offset = tbl_board_block[idx];
          for (int digit = 0; digit < 9; ++digit) {
            if (sudoku->full_mask[offset] & mask) {
              solution[idx] = (char) ('1' + digit);
              break;
            }
            offset += 3;
          }
        }
        solution[81] = 0;
      }
      if (n >= limit) return (n);
    }
    if (!rollback(sudoku, select))
      return (n);
  }
}

static int select_first(int mask) {
  return (mask & -mask);
}

extern int sudoku_solve_select(const char *puzzle, char *solution, int limit, int (*select)(int)) {
  sudoku_t sudoku;

  for (int idx = 0; idx < 81; ++idx) {
    if (isdigit(puzzle[idx])) sudoku.board[idx] = (byte) puzzle[idx];
    else if (puzzle[idx] == '.') sudoku.board[idx] = '0';
    else return 0;
  }
  sudoku_init(&sudoku);

  return calculate(&sudoku, limit, solution, select);
}

extern int sudoku_solve(const char *puzzle, char *solution, int limit) {
  return sudoku_solve_select(puzzle, solution, limit, &select_first);
}
